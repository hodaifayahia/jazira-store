

# تحسين صفحة إدارة المنتجات (Admin Products Page)

## ملخص
ترقية صفحة المنتجات في لوحة التحكم لتتوافق مع تصميم Foorweb المرجعي، مع إضافة بطاقات KPI، تبويبات ذكية، وحقل SKU.

## التغييرات المطلوبة

### 1. بطاقات KPI (إحصائيات سريعة)
أربع بطاقات في أعلى الصفحة:
- **كل المنتجات**: العدد الإجمالي
- **نفذت الكمية**: المنتجات التي مخزونها = 0
- **كمية منخفضة**: المنتجات التي مخزونها بين 1 و 5
- **مخفية**: المنتجات المعطلة (is_active = false)

### 2. تبويبات ذكية (Smart Tabs)
ثلاث تبويبات فوق الجدول:
- **كل المنتجات**: عرض الكل (الافتراضي)
- **المضافة حديثاً**: مرتبة حسب created_at (آخر 7 أيام)
- **الأكثر مبيعاً**: مرتبة حسب عدد مرات الطلب (يتطلب استعلام من جدول order_items)

### 3. إضافة حقل SKU
- إضافة عمود `sku` في جدول `products` عبر migration
- عرض SKU في الجدول وحقل إدخاله في نموذج المنتج
- البحث يشمل الاسم + SKU

### 4. رابط معاينة المنتج
- عمود "معاينة" في الجدول يفتح صفحة المنتج في المتجر (`/product/{id}`) في تبويب جديد

### 5. تحسين عمود الحالة
- استخدام Checkbox/Toggle بدلاً من الزر النصي الحالي (مطابقة للتصميم المرجعي)

---

## التفاصيل التقنية

### تعديل قاعدة البيانات (Migration)
```sql
ALTER TABLE products ADD COLUMN IF NOT EXISTS sku text;
CREATE UNIQUE INDEX IF NOT EXISTS products_sku_unique ON products(sku) WHERE sku IS NOT NULL AND sku != '';
```

### الملفات المتأثرة
- `src/pages/admin/AdminProductsPage.tsx` -- التعديل الرئيسي:
  1. إضافة مكون KPI cards (4 بطاقات) تحسب من بيانات المنتجات المحملة
  2. إضافة Tabs component (كل المنتجات / المضافة حديثاً / الأكثر مبيعاً)
  3. إضافة استعلام لجلب بيانات "الأكثر مبيعاً" من order_items مع group by product_id
  4. إضافة عمود SKU في الجدول + حقل SKU في ProductForm
  5. إضافة عمود "معاينة" مع رابط خارجي
  6. تحديث البحث ليشمل SKU
  7. تحديث ProductForm لتشمل حقل SKU

### حسابات KPI (من البيانات المحملة مسبقاً)
```text
totalProducts = products.length
outOfStock = products.filter(p => p.stock <= 0).length
lowStock = products.filter(p => p.stock > 0 && p.stock <= 5).length
hidden = products.filter(p => !p.is_active).length
```

### استعلام "الأكثر مبيعاً"
استعلام منفصل يجلب product_id مع عدد مرات الطلب من order_items:
```sql
SELECT product_id, SUM(quantity) as total_sold
FROM order_items
GROUP BY product_id
ORDER BY total_sold DESC
```

### ترتيب العناصر في الصفحة
```text
+--------------------------------------------------+
| عنوان الصفحة          | [تصدير] [استيراد] [إضافة] |
+--------------------------------------------------+
| [كل المنتجات] [كل] [نفذت] [منخفضة] [مخفية]       |
+--------------------------------------------------+
| [كل المنتجات | المضافة حديثاً | الأكثر مبيعاً]     |
+--------------------------------------------------+
| [بحث بالاسم أو SKU]  [فئة]  [حالة]               |
+--------------------------------------------------+
| [شريط العمليات الجماعية إن وجد]                   |
+--------------------------------------------------+
| الجدول: ☐ | صورة | المنتج | SKU | معاينة |       |
|           | الكمية | السعر | الحالة | إجراءات      |
+--------------------------------------------------+
| الترقيم                                           |
+--------------------------------------------------+
```

