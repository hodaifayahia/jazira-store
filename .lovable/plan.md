# Manual Order Creation + Product Image Seeding

## Overview

Two tasks: (1) Add a "Create Order" dialog in the admin orders page so admins can manually add orders with full client info and product selection, and (2) generate AI product images for all 6 seeded products and update them in the database.

---

## Part 1: Manual Order Creation Dialog

### New Component: `CreateOrderDialog`

Add an inline dialog component within `AdminOrdersPage.tsx` (or a separate file `src/components/admin/CreateOrderDialog.tsx`) that provides a complete manual order form.

#### Form Fields


| Field          | Type                                        | Required                       | Source                            |
| -------------- | ------------------------------------------- | ------------------------------ | --------------------------------- |
| Customer Name  | Text input                                  | Yes                            | Manual entry                      |
| Customer Phone | Text input (validated 05/06/07 + 10 digits) | Yes                            | Manual entry                      |
| Wilaya         | Select dropdown                             | Yes                            | `wilayas` table                   |
| Baladiya       | Select dropdown (loads after wilaya)        | No                             | `baladiyat` table                 |
| Delivery Type  | Radio/Select: "office" or "home"            | Yes                            | Manual                            |
| Address        | Textarea                                    | No (required if home delivery) | Manual entry                      |
| Payment Method | Select: cod / baridimob / flexy             | Yes                            | Manual                            |
| Products       | Multi-product selector with quantity        | Yes                            | `products` table                  |
| Coupon Code    | Text input (optional)                       | No                             | Validated against `coupons` table |
| Notes/Status   | Select initial status                       | No                             | Default "جديد"                    |


#### Product Selector

- Searchable dropdown listing all active products from the `products` table
- Each added product shows: name, unit price, quantity stepper (+/-)
- If product `has_variants`, show variant selector (from `product_variants` table)
- Running subtotal calculated live
- Shipping cost auto-calculated based on wilaya + delivery type (reuse logic from `src/lib/shipping.ts`)
- Total = subtotal + shipping - discount

#### Order Submission Flow

1. Validate all required fields
2. Insert into `orders` table with all fields (order_number is auto-generated by trigger)
3. Insert each product into `order_items` table with `order_id`, `product_id`, `quantity`, `unit_price`, `variant_id`
4. Show success toast and refresh orders list
5. Close dialog

#### UI Integration

- Add a "+" button next to the search bar in AdminOrdersPage header area
- Button text: "إضافة طلب" (Add Order)
- Dialog is responsive: full-screen sheet on mobile, centered dialog on desktop
- Form uses `grid-cols-1 sm:grid-cols-2` for field layout

### Files Changed


| File                                         | Action                                       |
| -------------------------------------------- | -------------------------------------------- |
| `src/components/admin/CreateOrderDialog.tsx` | Create -- full order creation form component |
| `src/pages/admin/AdminOrdersPage.tsx`        | Modify -- add button + import dialog         |


---

## Part 2: Generate Product Images with AI

### Approach

Use the existing `gemini-image` edge function to generate images for each of the 6 seeded products. The edge function already handles AI image generation and uploads to the `products` storage bucket.

### Image Prompts


| Product             | Prompt                                                                                                                   |
| ------------------- | ------------------------------------------------------------------------------------------------------------------------ |
| تمر المجهول الفاخر  | Premium Medjool dates arranged on a dark wooden plate, warm studio lighting, honey-gold color, close-up food photography |
| عسل السدر الطبيعي   | Natural Sidr honey in a glass jar with wooden dipper, golden amber color, honeycomb backdrop, warm studio lighting       |
| تمر دقلة نور        | Deglet Noor dates in an elegant bowl, translucent golden-brown, natural daylight, clean white background                 |
| عسل الزهور البرية   | Wildflower honey in a rustic ceramic pot, flowers scattered around, soft natural lighting, food photography              |
| علبة هدايا فاخرة    | Luxury gift box with assorted dates and honey jars, red ribbon, premium packaging, dark background                       |
| معجون التمر الطبيعي | Natural date paste in a glass jar, smooth dark brown texture, dates and nuts around it, warm tones                       |


### Implementation

Create a one-time admin action (button in settings or run via edge function) that:

1. Calls the `gemini-image` edge function for each product prompt
2. Gets back the public URL of the uploaded image
3. Updates the `products` table: sets `images` array to `[generated_url]`

This will be implemented as a helper function invoked during seeding or as a button in the admin products page. Since the products already exist with empty `images` arrays, we will update them with the generated URLs.

### Edge Function Enhancement

The existing `gemini-image` edge function already works. We need to add `modalities: ["image", "text"]` to the request body for proper image generation support.

### Files Changed


| File                                       | Action                                                                                        |
| ------------------------------------------ | --------------------------------------------------------------------------------------------- |
| `supabase/functions/gemini-image/index.ts` | Modify -- add `modalities` param to AI request                                                |
| `src/pages/admin/AdminProductsPage.tsx`    | Modify -- add "Generate Images" button that calls gemini-image for products with empty images |


---

## Implementation Sequence

1. Fix `gemini-image` edge function (add `modalities` field)
2. Create `CreateOrderDialog.tsx` component
3. Integrate dialog into `AdminOrdersPage.tsx`
4. Generate product images (call edge function for each product, update DB)
5. Test manual order creation flow end-to-end

## Technical Notes

- Order number is auto-generated by the `generate_order_number` database trigger -- no need to manually set it
- Shipping calculation reuses `calculateShippingForOrder` from `src/lib/shipping.ts`
- The wilayas table is currently empty -- may need to seed wilayas first for the order form to work properly
- All form inputs use Arabic labels consistent with existing admin pages
- RLS policies allow admin users to insert orders (admin has ALL access on orders table)
- Product images are stored in the `products` storage bucket under `generated/` path (already public)  
  
add also in dashobrad in settings a page wher ei have contrller over all of the banner image and images that are used in homage and the all of the text and tank u page all of the page i have controll over them in text and image